MONITORAMENTO COM TIG STACK
A TIG Stack é um conjunto de poderosas ferramentas de monitoramento de código aberto que utiliza tecnologias como Telegraf, InfluxDB e Grafana, onde:

• Telegraf é um agente de servidor de código aberto para coletar e enviar métricas e eventos de bancos de dados, sistemas e sensores IoT.
• InfluxDB é um banco de dados de séries temporais de código aberto e fornece armazenamento para métricas, eventos e análises em tempo real
• Grafana é uma ferramenta de visualização e monitoramento de dados e suporta bancos de dados de séries temporais como Graphite, InfluxDB, Prometheus, Elasticsearch.

A TIG Stack pode ser usada para monitorar métricas do sistema, como memória, disco, usuários conectados, carga do sistema, uso de swap, tempo de atividade do sistema e processos do sistema.
Para fazer a instalação, é necessário instalar e configurar individualmente cada componente da Stack.
Utilizaremos a distribuição Linux Ubuntu 22.04 como exemplo. Todo o processo pode variar em alguns pontos dependendo da distribuição escolhida, mas essencialmente seguem os mesmos passos a seguir.
Atenção: Certifique-se de que o sistema esteja atualizado antes de dar início a instalação da Stack.
INSTALANDO TELEGRAF
No terminal, digite os seguintes comandos para:

Baixar o arquivo de instalação:
sudo wget https://dl.influxdata.com/telegraf/releases/telegraf-1.28.4_linux_amd64.tar.gz

Descompactar o arquivo baixado:
sudo tar xf telegraf-1.28.4_linux_amd64.tar.gz

Instalar:
sudo apt install telegraf

Ativar (por padrão, vem desabilitado):
sudo systemctl enable --now telegraf
Checar ativação e estado atual:
sudo  systemctl status telegraf

INSTALANDO INFLUXDB
Similar a os procedimentos anteriores, no terminal digite os seguintes comandos:

Baixar e instalar o arquivo de instalação:
sudo apt-get update && sudo apt-get install influxdb

Retirar a máscara de serviço (necessário para versão do SO escolhida):
sudo systemctl unmask influxdb.service

Iniciar InfluxDB
sudo systemctl start influxdb

Chegar ativação e estado atual:
sudo systemctl status influxdb

INSTALANDO GRAFANA
Novamente, insira no terminal os seguintes comandos:

Baixar arquivo de instalação:
sudo apt install -y adduser libfontconfig1
sudo wget https://dl.grafana.com/oss/release/grafana_7.0.1_amd64.deb

Descompactar arquivo baixado:
sudo dpkg -i grafana_7.0.1_amd64.deb

Recarregar daemon do Sistema:
sudo systemctl daemon-reload

Ativar (por padrão, vem desabilitado)
sudo systemctl enable --now grafana-server

Checar ativação e estado atual:
sudo systemctl status grafana-server

Após todos os componentes devidamente instalados, prossiga agora com as configurações.

CONFIGURAR INFLUXDB PARA ARMAZENAR DADOS COLETADOS PELO TELEGRAF
Criaremos um banco de dados InfluxDB para armazenar as métricas de séries temporais coletadas pelo agente Telegraf. Conecte-se ao InfluxDB usando o comando do cliente influx:

sudo apt install influxdb-client
sudo influx
CREATE database telegraf
CREATE user telegraf with password 'myPassword'
GRANT all on telegraf to telegraf

Exiba o banco criado para verificar se tudo ocorreu corretamente:
SHOW databases

Use o comando para sair:
exit

Verifique a conexão do banco de dados criado usando as credenciais criadas acima:
sudo influx -username 'telegraf' password 'myPassword' -database telegraf

Use o comando para sair novamente:
exit

CONFIGURAR TELEGRAF PARA COLETAR DADOS

/etc/telegraf/telegraf.conf é o arquivo de configuração padrão utilizado pelo Telegraf. 
Configuraremos agora o monitoramento para uso de memória do sistema, processos do sistema, uso de disco, carga do sistema, tempo de atividade e usuários conectados.

Abra o arquivo de configuração mencionado:
sudo nano /etc/telegraf/telegraf.conf

Descomente e preencha os seguintes trechos com as informações necessárias:
[[outputs.influxdb]]
  urls = ["http://127.0.0.1:8086"]
  database = "telegraf"
  username = "telegraf"
  password = "myP@SSword"

Salve o arquivo e reinicie o Telegraf após as modificações
sudo systemctl restart telegraf

Cheque novamente os três componentes para dar continuação a instalação da Stack:
sudo systemctl status telegraf
sudo systemctl status influxdb
sudo systemctl status grafana-server

ACESSANDO A INTERFACE WEB GRAFANA
Para permitir o acesso externo, é necessário abrir a porta 3000/tcp com o seguinte comando no terminal:
ufw allow 3000/tcp
Agora no navegador de sua escolha, acesse http://localhost:3000 para acessar a interface Grafana. 
Na página de login, digite admin tanto para o campo de login quanto para o campo de senha.
Crie uma nova senha e prossiga na interface.
ADICIONANDO BANCO DE DADOS INFLUXDB NA INTERFACE
Para adicionar o banco de dados criado anteriormente:
Selecione “”
Selecione InfluxDB
Preencha o nome que desejar e a URL do banco de dados escolhido.
NAME = InfluxDB
URL = http://localhost:8086
Teste a conexão do banco clicando no botão Save&Test

IMPORTANDO UMA DASHBOARD DA COMUNIDADE
Você pode criar suas próprias dashboards para o Telegraf ou encontrar aqueles que atendem às suas necessidades nas dashboards da comunidade Grafana já criadas. Para demonstrar, utilizaremos uma dashboard de métricas (https://grafana.com/grafana/dashboards/5955) criada pelo usuário jmutai.
Para importar a dashboard, clique no botão de [ + ]  no painel esquerdo da interface do usuário do Grafana. Você pode importar usando o ID da dashboard ou o arquivo JSON fornecido na página específica da dashboard do Grafana.
Clique em Carregar para carregar a dashboard.
Assim que a dashboard carregar, selecione a fonte de dados do InfluxDB e importe ela. 
Agora você deverá ser capaz de ver vários painéis detalhando várias métricas do sistema.






